#!/bin/sh

# Husky pre-commit (non-interactive)
# Note: avoiding deprecated husky.sh include and interactive prompts

# Make Next/ESLint non-interactive
export NEXT_TELEMETRY_DISABLED=1
export CI=1

# 1) Lint (do not block commit if lint fails in dev)
if npm run -s lint >/dev/null 2>&1; then
  echo "husky: lint ok"
else
  echo "husky: lint warnings/errors (skipped blocking)"
fi

# 2) Tests only if using a test database
if [ -n "$DATABASE_URL" ] && printf "%s" "$DATABASE_URL" | grep -qi "test"; then
  echo "husky: running tests against test DB"
  npm test -- --runInBand || echo "husky: tests failed (not blocking commit)"
else
  echo "husky: skipping tests (DATABASE_URL not set to test)"
fi

exit 0
